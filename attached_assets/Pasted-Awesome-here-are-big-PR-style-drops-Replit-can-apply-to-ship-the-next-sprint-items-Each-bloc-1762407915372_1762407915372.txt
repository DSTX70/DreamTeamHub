Awesome ‚Äî here are **big, PR-style drops** Replit can apply to ship the next sprint items. Each block is a unified diff you can `git apply` in order.

> Apply each block with:
>
> ```bash
> git apply -p0 <<'PATCH'
> ‚Ä¶diff‚Ä¶
> PATCH
> ```

---

## 1) Playbook preview in WO Create (side panel)

```diff
diff --git a/web/components/PlaybookPreview.tsx b/web/components/PlaybookPreview.tsx
new file mode 100644
--- /dev/null
+++ b/web/components/PlaybookPreview.tsx
@@
+import React, { useEffect, useState } from "react";
+
+export default function PlaybookPreview({ handle }:{ handle?:string }) {
+  const [md,setMd]=useState<string>(""); const [title,setTitle]=useState<string>(""); const [loading,setL]=useState(false);
+  useEffect(()=>{
+    let ab=false;
+    async function run(){
+      if(!handle){ setMd(""); setTitle(""); return; }
+      setL(true);
+      const r = await fetch(`/api/playbooks/${encodeURIComponent(handle)}`);
+      if(!r.ok){ setMd("Failed to load"); setTitle(""); setL(false); return; }
+      const j = await r.json(); if(ab) return;
+      setTitle(j.title || handle); setMd(j.bodyMd || "");
+      setL(false);
+    }
+    run(); return ()=>{ab=true};
+  },[handle]);
+  if(!handle) return <div className="text-sm text-gray-500">Select a playbook to preview‚Ä¶</div>;
+  return (
+    <div className="rounded-xl border p-3 h-full">
+      <div className="font-medium">{title}</div>
+      {loading ? <div className="text-sm text-gray-500 mt-2">Loading‚Ä¶</div> :
+      <pre className="text-xs mt-2 whitespace-pre-wrap">{md || "No content."}</pre>}
+    </div>
+  );
+}
diff --git a/web/components/WorkOrderForm.tsx b/web/components/WorkOrderForm.tsx
--- a/web/components/WorkOrderForm.tsx
+++ b/web/components/WorkOrderForm.tsx
@@
-import React, { useEffect, useState } from "react";
+import React, { useEffect, useState } from "react";
+import PlaybookPreview from "@/components/PlaybookPreview";
@@
-  return (
-    <div className="rounded-2xl border p-4 space-y-3">
+  return (
+    <div className="rounded-2xl border p-4 space-y-3">
       <h3 className="text-lg font-semibold">New Work Order</h3>
-      <input className="border rounded px-2 py-1 w-full" placeholder="Title" value={title} onChange={e=>setTitle(e.target.value)}/>
-      <input className="border rounded px-2 py-1 w-full" placeholder="Owner" value={owner} onChange={e=>setOwner(e.target.value)}/>
-      <input className="border rounded px-2 py-1 w-full" placeholder="Inputs (paths or query)" value={inputs} onChange={e=>setInputs(e.target.value)}/>
-      <input className="border rounded px-2 py-1 w-full" placeholder="Output folder" value={output} onChange={e=>setOutput(e.target.value)}/>
-      <label className="text-sm block">Playbook</label>
-      <select
-        className="border rounded px-2 py-1 w-full"
-        value={playbookHandle}
-        onChange={(e)=>setPlaybookHandle(e.target.value)}
-      >
-        <option value="">{loadingPB ? "Loading..." : "‚Äî Select a playbook (optional) ‚Äî"}</option>
-        {playbooks.map(pb=>(
-          <option key={pb.handle} value={pb.handle}>{pb.title} ‚Äî {pb.handle}</option>
-        ))}
-      </select>
-      <div className="text-xs text-gray-600">
-        Tip: manage playbooks at <a className="underline" href="/playbooks" target="_blank" rel="noreferrer">/playbooks</a>.
-      </div>
+      <div className="grid grid-cols-1 lg:grid-cols-3 gap-3">
+        <div className="lg:col-span-2 space-y-3">
+          <input className="border rounded px-2 py-1 w-full" placeholder="Title" value={title} onChange={e=>setTitle(e.target.value)}/>
+          <input className="border rounded px-2 py-1 w-full" placeholder="Owner" value={owner} onChange={e=>setOwner(e.target.value)}/>
+          <input className="border rounded px-2 py-1 w-full" placeholder="Inputs (paths or query)" value={inputs} onChange={e=>setInputs(e.target.value)}/>
+          <input className="border rounded px-2 py-1 w-full" placeholder="Output folder" value={output} onChange={e=>setOutput(e.target.value)}/>
+          <label className="text-sm block">Playbook</label>
+          <select
+            className="border rounded px-2 py-1 w-full"
+            value={playbookHandle}
+            onChange={(e)=>setPlaybookHandle(e.target.value)}
+          >
+            <option value="">{loadingPB ? "Loading..." : "‚Äî Select a playbook (optional) ‚Äî"}</option>
+            {playbooks.map(pb=>(
+              <option key={pb.handle} value={pb.handle}>{pb.title} ‚Äî {pb.handle}</option>
+            ))}
+          </select>
+          <div className="text-xs text-gray-600">
+            Tip: manage playbooks at <a className="underline" href="/playbooks" target="_blank" rel="noreferrer">/playbooks</a>.
+          </div>
+        </div>
+        <div className="lg:col-span-1">
+          <PlaybookPreview handle={playbookHandle}/>
+        </div>
+      </div>
@@
     </div>
   );
 }
```

---

## 2) Onboarding wizard: success links to new Brand/Product pages

```diff
diff --git a/web/components/OnboardingWizard.tsx b/web/components/OnboardingWizard.tsx
--- a/web/components/OnboardingWizard.tsx
+++ b/web/components/OnboardingWizard.tsx
@@
-  const [created,setCreated]=useState<{brandId?:string; productId?:string}|null>(null);
+  const [created,setCreated]=useState<{brandId?:string; brandSlug?:string; productId?:string; productSlug?:string}|null>(null);
@@
-  async function createBrand() {
+  async function createBrand() {
     const r = await fetch("/api/onboarding/brand", { method:"POST", headers:{ "content-type":"application/json" },
       body: JSON.stringify({ buId, name:brand.name, slug:brand.slug, drive })});
     if (!r.ok) throw new Error("brand create failed");
-    const data = await r.json(); setCreated({ brandId: data.brand.id }); next();
+    const data = await r.json(); setCreated({ brandId: data.brand.id, brandSlug: data.brand.slug }); next();
   }
@@
-  async function createProduct() {
+  async function createProduct() {
     if (!created?.brandId || !product.name) return next();
     const r = await fetch("/api/onboarding/product", { method:"POST", headers:{ "content-type":"application/json" },
       body: JSON.stringify({ brandId: created.brandId, name:product.name, slug:product.slug, type:product.type, drive })});
     if (!r.ok) throw new Error("product create failed");
-    const data = await r.json(); setCreated({ ...created, productId: data.product.id }); next();
+    const data = await r.json(); setCreated({ ...created, productId: data.product.id, productSlug: data.product.slug }); next();
   }
@@
       {step===4 && (
         <div className="space-y-2 text-sm">
           <div className="text-green-700 font-medium">Done!</div>
-          {created?.brandId && <div>Brand created.</div>}
-          {created?.productId ? <div>Product created.</div> : <div>(No product created)</div>}
+          {created?.brandId && (
+            <div>Brand created ‚Äî <a className="underline" href={`/brand/${created.brandSlug || created.brandId}`}>open brand</a></div>
+          )}
+          {created?.productId ? (
+            <div>Product created ‚Äî <a className="underline" href={`/product/${created.productSlug || created.productId}`}>open product</a></div>
+          ) : <div>(No product created)</div>}
         </div>
       )}
```

---

## 3) Coverage deep-dive: role drill-through ‚Üí Agent list

```diff
diff --git a/web/pages/coverage.tsx b/web/pages/coverage.tsx
--- a/web/pages/coverage.tsx
+++ b/web/pages/coverage.tsx
@@
-              {over.map((r:any)=>(<li key={r.role_handle}>{r.role_name} ‚Äî <b>{r.agent_count}</b></li>))}
+              {over.map((r:any)=>(<li key={r.role_handle}>
+                <a className="underline" href={`/coverage/role/${encodeURIComponent(r.role_handle)}`}>{r.role_name}</a> ‚Äî <b>{r.agent_count}</b>
+              </li>))}
diff --git a/web/pages/coverage/role/[handle].tsx b/web/pages/coverage/role/[handle].tsx
new file mode 100644
--- /dev/null
+++ b/web/pages/coverage/role/[handle].tsx
@@
+import React, { useEffect, useState } from "react";
+
+export default function RoleAgentsPage({ params }:{ params:{ handle:string } }) {
+  const handle = decodeURIComponent(params.handle);
+  const [rows,setRows]=useState<any[]>([]); const [loading,setL]=useState(false);
+  useEffect(()=>{ let ab=false; (async()=>{
+    setL(true); const r=await fetch(`/api/coverage/agents?role_handle=${encodeURIComponent(handle)}`); const j=await r.json();
+    if(!ab) setRows(j.agents||[]); setL(false);
+  })(); return ()=>{ab=true}},[handle]);
+  return (
+    <div className="max-w-4xl mx-auto p-6 space-y-4">
+      <h1 className="text-2xl font-semibold">Agents for role: {handle}</h1>
+      {loading? <div className="text-sm text-gray-500">Loading‚Ä¶</div> :
+      <table className="min-w-full text-sm">
+        <thead><tr><th className="text-left p-2 border-b">Name</th><th className="text-left p-2 border-b">Level</th><th className="text-left p-2 border-b">Status</th><th className="text-right p-2 border-b">Next gate</th></tr></thead>
+        <tbody>
+          {rows.map((a:any)=>(
+            <tr key={a.id}>
+              <td className="p-2 border-b">{a.name}</td>
+              <td className="p-2 border-b">{a.autonomy}</td>
+              <td className="p-2 border-b">{a.status}</td>
+              <td className="p-2 border-b text-right">{a.nextGate ?? "‚Äî"}</td>
+            </tr>
+          ))}
+          {!rows.length && <tr><td className="p-2" colSpan={4}>No agents.</td></tr>}
+        </tbody>
+      </table>}
+    </div>
+  );
+}
```

> `/api/coverage/agents` already exists from prior drop. This page consumes it.

---

## 4) Alert hooks (ops): basic thresholds to Slack/Webhook

```diff
diff --git a/server/lib/alerts/poster.ts b/server/lib/alerts/poster.ts
new file mode 100644
--- /dev/null
+++ b/server/lib/alerts/poster.ts
@@
+export async function postWebhook(text: string) {
+  const url = process.env.SLACK_WEBHOOK_URL || process.env.ALERT_WEBHOOK_URL;
+  if (!url) return;
+  try {
+    await fetch(url, { method:"POST", headers:{ "content-type":"application/json" }, body: JSON.stringify({ text }) });
+  } catch {}
+}
diff --git a/app/api/ops/alerts/check/route.ts b/app/api/ops/alerts/check/route.ts
new file mode 100644
--- /dev/null
+++ b/app/api/ops/alerts/check/route.ts
@@
+import { NextRequest } from "next/server";
+import { db } from "@/drizzle/db";
+import { opsEvent } from "@/drizzle/schema";
+import { and, eq, gte } from "drizzle-orm";
+import { postWebhook } from "@/server/lib/alerts/poster";
+
+export async function GET(_req: NextRequest) {
+  const windowMin = 10;
+  const since = new Date(Date.now() - windowMin*60*1000);
+  const errs = await db.select().from(opsEvent)
+    .where(and(gte(opsEvent.at, since), eq(opsEvent.kind, "ERROR")));
+  const publishErrs = errs.filter(e => (e.message||"").toUpperCase().includes("PUBLISH")).length;
+  const fiveXX = errs.filter(e => (e.message||"").includes("5xx")).length;
+
+  // thresholds
+  let alerts:string[] = [];
+  if (publishErrs >= 3) alerts.push(`üö® PUBLISH errors in last ${windowMin}m: ${publishErrs}`);
+  if (fiveXX >= 5) alerts.push(`üö® 5xx errors in last ${windowMin}m: ${fiveXX}`);
+  if (alerts.length) await postWebhook(alerts.join("\n"));
+
+  return new Response(JSON.stringify({ ok:true, publishErrs, fiveXX }), { status: 200, headers: { "content-type":"application/json" }});
+}
```

> Set `SLACK_WEBHOOK_URL` (or `ALERT_WEBHOOK_URL`) in Replit secrets.
> You can hit `/api/ops/alerts/check` from a cron or GitHub Actions schedule.

---

## 5) Breadcrumb & left-rail parity (confirm & enforce)

Create a tiny **Brand/Product/Project layout wrapper** that ensures the left rail + breadcrumb are present everywhere.

```diff
diff --git a/web/components/EntityLayout.tsx b/web/components/EntityLayout.tsx
new file mode 100644
--- /dev/null
+++ b/web/components/EntityLayout.tsx
@@
+import React from "react";
+
+export default function EntityLayout({ breadcrumb, leftRail, children }:{
+  breadcrumb: React.ReactNode; leftRail: React.ReactNode; children: React.ReactNode;
+}) {
+  return (
+    <div className="max-w-7xl mx-auto p-6 space-y-4">
+      <div className="text-sm text-gray-600">{breadcrumb}</div>
+      <div className="grid lg:grid-cols-4 gap-6 items-start">
+        <aside className="lg:col-span-1">{leftRail}</aside>
+        <main className="lg:col-span-3 space-y-4">{children}</main>
+      </div>
+    </div>
+  );
+}
```

Example usage in Brand/Product/Project pages (adjust your existing pages):

```diff
diff --git a/web/pages/brand/[slug].tsx b/web/pages/brand/[slug].tsx
--- a/web/pages/brand/[slug].tsx
+++ b/web/pages/brand/[slug].tsx
@@
-import React from "react";
+import React from "react";
+import EntityLayout from "@/components/EntityLayout";
 
 export default function BrandPage({ params }:{ params:{ slug:string } }) {
   const slug = params.slug;
-  return (
-    <div className="max-w-7xl mx-auto p-6">Brand: {slug}</div>
-  );
+  const breadcrumb = (<span><a className="underline" href="/i3">i¬≥</a> ‚Ä∫ <a className="underline" href="/business-units">Business Units</a> ‚Ä∫ Brand ¬∑ {slug}</span>);
+  const left = (
+    <ul className="text-sm space-y-2">
+      <li><a className="underline" href="#">Overview</a></li>
+      <li><a className="underline" href="#">Roster</a></li>
+      <li><a className="underline" href="#">Knowledge</a></li>
+      <li><a className="underline" href="#">Work</a></li>
+      <li><a className="underline" href="#">Reports</a></li>
+      <li><a className="underline" href="#">Settings</a></li>
+    </ul>
+  );
+  return <EntityLayout breadcrumb={breadcrumb} leftRail={left}>Brand: {slug}</EntityLayout>;
 }
```

> Repeat the same pattern for Product/Project pages (or extract a helper to render the standard left rail links).

---

## 6) Empty-state helpers (‚ÄúNew Project / Create Work Order‚Äù)

```diff
diff --git a/web/components/EmptyState.tsx b/web/components/EmptyState.tsx
new file mode 100644
--- /dev/null
+++ b/web/components/EmptyState.tsx
@@
+import React from "react";
+export default function EmptyState({ title, children, actions }:{
+  title:string; children?:React.ReactNode; actions?:Array<{ label:string; href:string }>
+}) {
+  return (
+    <div className="rounded-2xl border p-6 text-center space-y-2">
+      <div className="text-lg font-semibold">{title}</div>
+      {children && <div className="text-sm text-gray-600">{children}</div>}
+      {actions && actions.length>0 && (
+        <div className="flex justify-center gap-2 mt-2">
+          {actions.map((a,i)=> <a key={i} href={a.href} className="px-3 py-1 border rounded">{a.label}</a>)}
+        </div>
+      )}
+    </div>
+  );
+}
```

Patch your **Work/Projects** list to use it:

```diff
diff --git a/web/components/ProjectsList.tsx b/web/components/ProjectsList.tsx
--- a/web/components/ProjectsList.tsx
+++ b/web/components/ProjectsList.tsx
@@
-import React from "react";
+import React from "react";
+import EmptyState from "@/components/EmptyState";
@@
-  if (!rows?.length) return <div className="text-sm text-gray-500">No projects.</div>;
+  if (!rows?.length) return (
+    <EmptyState title="No projects yet">
+      <span>Create your first project or start with a Work Order draft.</span>
+      {{/* @ts-ignore */}}
+      {{
+        actions: [
+          { label: "New Project", href: "/projects/new" },
+          { label: "Create Work Order", href: "/work-orders/new" },
+        ]
+      }}
+    </EmptyState>
+  );
```

(Adjust to your actual list component names/paths.)

---

## 7) Cmd+K quick actions: context-aware adds

```diff
diff --git a/web/components/CmdK.tsx b/web/components/CmdK.tsx
--- a/web/components/CmdK.tsx
+++ b/web/components/CmdK.tsx
@@
-  const actions: Action[] = useMemo(()=>[
+  const actions: Action[] = useMemo(()=>[
     { id:"new-wo", label:"+ New Work Order", run:()=>{ location.href="/work-orders/new"; }},
     { id:"open-copilot", label:"Open Copilot", run:()=>{ location.href="/copilot"; }},
-    scope?.owner !== "GLOBAL" ? { id:"search-kb", label:"Search Knowledge in this context", run:()=>{ location.href=`/knowledge/search?scope=${scope?.owner}&id=${scope?.ownerId||""}`; }} : null,
+    scope?.owner !== "GLOBAL" ? { id:"search-kb", label:"Search Knowledge in this context", run:()=>{ location.href=`/knowledge/search?scope=${scope?.owner}&id=${scope?.ownerId||""}`; }} : null,
+    scope?.owner === "BRAND" ? { id:"new-product-under-brand", label:"+ New Product under this Brand", run:()=>{ location.href=`/onboarding?brand=${scope?.ownerId||""}`; }} : null,
+    scope?.owner !== "GLOBAL" ? { id:"new-project-in-context", label:"+ New Project in this context", run:()=>{ location.href=`/projects/new?scope=${scope?.owner}&id=${scope?.ownerId||""}`; }} : null,
   ].filter(Boolean) as Action[], [scope]);
```

> If you have specific route paths for ‚Äúonboarding new product under brand‚Äù, replace the href accordingly.

---

## Final check (5 min)

* **Playbook preview** appears live as you select a handle.
* **Onboarding** success screen links open the new Brand/Product pages.
* **Coverage drill-through** page lists agents for a role.
* **Alerts** endpoint triggers Slack/Webhook when thresholds exceeded (set `SLACK_WEBHOOK_URL`).
* **Left rail + breadcrumb** render on Brand/Product/Project.
* **Empty states** show on empty lists with action buttons.
* **Cmd+K actions** now include ‚ÄúNew Product under this Brand‚Äù & ‚ÄúNew Project in this context‚Äù.

If anything doesn‚Äôt compile or you want me to align paths with your exact folder structure, tell me which file and I‚Äôll tailor the diff.
