{
  "workItemId": "37",
  "stage": "RECOMMENDATION_APPROVED",
  "created_at": "2025-12-29T05:07:30.794Z",
  "updated_at": "2025-12-29T15:09:35.410Z",
  "recommendation": {
    "text": "# Recommendation (Non-executing)\n\n**Target Repo:** GigsterGarage\n\n**Strategy Session: (none)**\n\n## What we're doing\nConvert the locked strategy into an implementation plan for **GigsterGarage**.\n\n## Proposed approach\n1) Confirm the exact files/route(s) in GigsterGarage impacted by this change.\n2) Implement the smallest additive patch (no refactors) behind safe guards.\n3) Provide post-apply verification steps.\n\n## Inputs (from Work Item)\n\n---\nIntent: (Pilot C-style test):\n\nIntent / Goal: Stop 401 spam + query noise when logged out/expired auth in GigsterGarage.\n\nExpected outcome: No repeated 401s; no [object Object] requests; polling slows when inactive.\n\nAutonomy: STANDARD\n\n---\nCast Receipt\nMode: AUTO\nAutonomy: STANDARD\nTarget Context: GigsterGarage\nPods:\n  - AUTO\nPersonas:\n  - AUTO\n---\n\n---\n\n## Approval required\nNo drop should be generated or applied until Dustin approves this recommendation.\n\n\n---\n## Read-only repo context (GigsterGarage)\n**Source:** DreamTeamHub ‚Üí GigsterGarage read-only connector\n**Meta:** requested=7 returned=7 nonEmpty=7 errors=0 truncatedChars=7111\n\nUse the file blocks below to propose *specific diffs* that stop 401 spam + query noise.\n\nFILE: client/src/hooks/useAuth.ts\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\ninterface AuthResponse {\n  user: User;\n}\n\nexport function useAuth() {\n  const { data, isLoading, isFetching, error } = useQuery<AuthResponse | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/auth/user\", { credentials: \"include\" });\n\n      // Treat 401 as \"not authenticated\" (not an error)\n      if (res.status === 401) return null;\n\n      if (!res.ok) {\n        const text = (await res.text()) || res.statusText;\n        throw new Error(`Auth check failed (${res.status}): ${text}`);\n      }\n\n      return (await res.json()) as AuthResponse;\n    },\n    retry: false,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: false,\n    staleTime: 30_000,\n    // Only poll if logged in; prevents repeated 401s when logged out\n    refetchInterval: (query) => (query.state.data?.user ? 60_000 : false),\n  });\n\n  const user = data?.user;\n  const authReady = !isLoading && !isFetching;\n\n  return {\n    user,\n    authReady,\n    isLoading,\n    isFetching,\n    isAuthenticated: !!user,\n    isAdmin: user?.role === \"admin\",\n    isDemoUser: !!user?.isDemo,\n    demoSessionId: user?.demoSessionId,\n    sessionExpiresAt: user?.sessionExpiresAt,\n    error,\n  };\n}\n\nEND_FILE\n\nFILE: client/src/lib/queryClient.ts\nimport { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n// Simple URL resolution - uses relative paths for same-origin requests\nconst resolveUrl = (path: string): string => {\n  if (!path) throw new Error(\"apiRequest: empty path\");\n  // If already absolute URL, use as-is\n  if (/^https?:\\/\\//i.test(path)) return path;\n  // Otherwise use relative path (Vite serves backend on same port)\n  return path;\n};\n\n// Safe JSON stringify (handles BigInt by stringifying it)\nconst safeStringify = (value: unknown): string => {\n  try {\n    return JSON.stringify(value, (_, v) => (typeof v === \"bigint\" ? v.toString() : v));\n  } catch (e: any) {\n    throw new Error(`apiRequest: JSON serialization failed: ${e?.message || String(e)}`);\n  }\n};\n\n// Best-effort: if we see 401/403 anywhere, force re-check of /api/auth/user\nfunction invalidateAuthUserQuery() {\n  try {\n    const qc = (globalThis as any).__GG_QUERY_CLIENT__;\n    if (qc?.invalidateQueries) {\n      qc.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    }\n  } catch {\n    // ignore\n  }\n}\n\nexport type ApiMethod = \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\";\n\nexport async function apiRequest<T = unknown>(\n  method: ApiMethod,\n  path: string,\n  body?: unknown,\n  init?: RequestInit\n): Promise<T> {\n  const url = resolveUrl(path);\n  const hasBody = body !== undefined && method !== \"GET\";\n  const serialized = hasBody ? safeStringify(body) : undefined;\n\n  const res = await fetch(url, {\n    method,\n    credentials: \"include\",\n    headers: {\n      ...(hasBody ? { \"Content-Type\": \"application/json\" } : {}),\n      ...(init?.headers || {}),\n    },\n    body: serialized,\n    ...init,\n  });\n\n  // If auth expired, force /api/auth/user to re-check so polling can stop via gating\n  if (res.status === 401 || res.status === 403) {\n    invalidateAuthUserQuery();\n  }\n\n  const contentType = res.headers.get(\"content-type\") || \"\";\n  let parsed: any = null;\n  try {\n    parsed = contentType.includes(\"application/json\") ? await res.json() : await res.text();\n  } catch {\n    // Ignore parse error; keep parsed=null so we can surface status text\n  }\n\n  if (!res.ok) {\n    const serverMsg =\n      (parsed && typeof parsed === \"object\" && (parsed.error?.message || parsed.message)) ||\n      (typeof parsed === \"string\" ? parsed : res.statusText);\n\n    throw new Error(`HTTP ${res.status} ${res.statusText}: ${serverMsg || \"Request failed\"}`);\n  }\n\n  return parsed as T;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    if (res.status === 401 || res.status === 403) {\n      invalidateAuthUserQuery();\n    }\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\n\nfunction isPlainObject(v: any): v is Record<string, any> {\n  return !!v && typeof v === \"object\" && !Array.isArray(v);\n}\n\n/**\n * Builds a URL from a TanStack queryKey.\n * Fixes \"/[object Object]\" noise by converting object parts into query params.\n *\n * Examples:\n *  [\"/api/timelogs\"] -> \"/api/timelogs\"\n *  [\"/api/productivity/stats\", {days:7}] -> \"/api/productivity/stats?days=7\"\n *  [\"/api/x\", \"abc\"] -> \"/api/x/abc\"\n */\nfunction buildUrlFromQueryKey(queryKey: unknown[]): string {\n  if (!Array.isArray(queryKey) || queryKey.length === 0) {\n    throw new Error(\"QueryFn: invalid queryKey\");\n  }\n\n  const base = queryKey[0];\n  if (typeof base !== \"string\") {\n    throw new Error(\"QueryFn: queryKey[0] must be a string path\");\n  }\n\n  let path = base;\n  const params = new URLSearchParams();\n\n  for (let i = 1; i < queryKey.length; i++) {\n    const part: any = queryKey[i];\n\n    if (part == null) continue;\n\n    if (isPlainObject(part)) {\n      for (const [k, v] of Object.entries(part)) {\n        if (v == null) continue;\n        params.set(k, String(v));\n      }\n      continue;\n    }\n\n    // primitives become path segments\n    if (typeof part === \"string\" || typeof part === \"number\" || typeof part === \"boolean\") {\n      path += `/${encodeURIComponent(String(part))}`;\n      continue;\n    }\n\n    // last resort: stringify to query param\n    try {\n      params.set(`q${i}`, JSON.stringify(part));\n    } catch {\n      params.set(`q${i}`, String(part));\n    }\n  }\n\n  const qs = params.toString();\n  return qs ? `${path}?${qs}` : path;\n}\n\nexport const getQueryFn: <T>(options: { on401: UnauthorizedBehavior }) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const url = buildUrlFromQueryKey(queryKey as unknown[]);\n    const res = await fetch(resolveUrl(url), {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null as any;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      refetchOnReconnect: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n\n// Expose queryClient for best-effort auth invalidation without circular TS ordering issues\n(globalThis as any).__GG_QUERY_CLIENT__ = queryClient;\n\nEND_FILE\n\nFILE: client/src/components/timer-widget.tsx\nimport { useState, useEffect } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Play, Square, Clock, Settings } from \"lucide-react\";\nimport type { TimeLog, Task, Project } from \"@shared/schema\";\n\n// Helper function to format duration\nconst formatDuration = (seconds: number): string => {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  const secs = seconds % 60;\n  \n  if (hours > 0) {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  }\n  return `${minutes}:${secs.toString().padStart(2, '0')}`;\n};\n\nexport function TimerWidget() {\n  const [selectedTaskId, setSelectedTaskId] = useState<string>(\"\");\n  const [selectedProjectId, setSelectedProjectId] = useState<string>(\"\");\n  const [description, setDescription] = useState<string>(\"\");\n  const [currentTime, setCurrentTime] = useState<number>(0);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  \n  const queryClient = useQueryClient();\n  \n  // Fetch active timer\n  const { data: activeTimer, isLoading: timerLoading } = useQuery<TimeLog | null>({\n    queryKey: [\"/api/timelogs/active\"],\n    refetchInterval: (data) => data ? 5000 : 30000, // Update every 5 seconds if active, otherwise every 30 seconds\n    staleTime: 1000 * 2, // 2 seconds stale time to reduce flashing\n    refetchOnWindowFocus: false, // Prevent refetch on window focus\n    refetchOnReconnect: false, // Prevent refetch on reconnect\n  });\n\n  // Fetch projects and tasks for selection\n  const { data: projects = [] } = useQuery<Project[]>({\n    queryKey: [\"/api/projects\"],\n    staleTime: 1000 * 60 * 5, // 5 minutes stale time\n    refetchOnWindowFocus: false,\n  });\n\n  const { data: tasks = [] } = useQuery<Task[]>({\n    queryKey: [\"/api/tasks\"],\n    staleTime: 1000 * 60 * 5, // 5 minutes stale time\n    refetchOnWindowFocus: false,\n  });\n\n  // Update current time for active timer\n  useEffect(() => {\n    if (activeTimer && activeTimer.isActive) {\n      const interval = setInterval(() => {\n        const now = Date.now();\n        const startTime = new Date(activeTimer.startTime).getTime();\n        setCurrentTime(Math.floor((now - startTime) / 1000));\n      }, 1000);\n\n      return () => clearInterval(interval);\n    }\n  }, [activeTimer]);\n\n  // Start timer mutation\n  const startTimerMutation = useMutation({\n    mutationFn: async (data: { taskId?: string; projectId?: string; description?: string }) => {\n      return apiRequest(\"POST\", \"/api/timelogs/start\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs/active\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      setIsDialogOpen(false);\n      setSelectedTaskId(\"\");\n      setSelectedProjectId(\"\");\n      setDescription(\"\");\n    },\n  });\n\n  // Stop timer mutation\n  const stopTimerMutation = useMutation({\n    mutationFn: async (timeLogId: string) => {\n      return apiRequest(\"POST\", \"/api/timelogs/stop\", { timeLogId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs/active\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/productivity/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/streaks\"] });\n      setCurrentTime(0);\n      // Reset timer display to show \"Timer Ready\" state\n    },\n  });\n\n  const handleStartTimer = () => {\n    startTimerMutation.mutate({\n      taskId: selectedTaskId === \"no-task\" ? undefined : selectedTaskId || undefined,\n      projectId: selectedProjectId === \"no-project\" ? undefined : selectedProjectId || undefined,\n      description: description.trim() || \"Working\",\n    });\n  };\n\n  const handleStopTimer = () => {\n    if (activeTimer) {\n      stopTimerMutation.mutate(activeTimer.id);\n    }\n  };\n\n  return (\n    <Card className=\"w-full max-w-md bg-orange-50 border-orange-200\" data-testid=\"timer-widget\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Clock className=\"h-5 w-5 text-orange-600\" />\n            <div>\n              {timerLoading ? (\n                <div>\n                  <div className=\"text-lg font-semibold text-orange-900\">Loading...</div>\n                  <div className=\"text-xs text-orange-700\">Checking timer status</div>\n                </div>\n              ) : activeTimer && activeTimer.isActive ? (\n                <div>\n                  <div className=\"text-2xl font-bold text-orange-900\" data-testid=\"timer-display\">\n                    {formatDuration(currentTime)}\n                  </div>\n                  <div className=\"text-xs text-orange-700\" data-testid=\"timer-description\">\n                    {activeTimer.description || \"Working on task\"}\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  <div className=\"text-lg font-semibold text-orange-900\">Timer Ready</div>\n                  <div className=\"text-xs text-orange-700\">Click start to begin tracking</div>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"flex items-center space-x-2\">\n            {!timerLoading && activeTimer && activeTimer.isActive ? (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={handleStopTimer}\n                disabled={stopTimerMutation.isPending}\n                className=\"border-red-300 text-red-700 hover:bg-red-50\"\n                data-testid=\"button-stop-timer\"\n              >\n                <Square className=\"h-4 w-4\" />\n                Stop\n              </Button>\n            ) : !timerLoading ? (\n              <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button\n                    size=\"sm\"\n                    className=\"bg-orange-600 hover:bg-orange-700 text-white\"\n                    data-testid=\"button-start-timer\"\n                  >\n                    <Play className=\"h-4 w-4\" />\n                    Start\n                  </Button>\n                </DialogTrigger>\n                \n                <DialogContent data-testid=\"dialog-start-timer\">\n                  <DialogHeader>\n                    <DialogTitle className=\"text-orange-900\">Start Timer</DialogTitle>\n                  </DialogHeader>\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"timer-project\" className=\"text-sm font-medium\">\n                        Project (Optional)\n                      </Label>\n                      <Select value={selectedProjectId} onValueChange={setSelectedProjectId}>\n                        <SelectTrigger data-testid=\"select-timer-project\">\n                          <SelectValue placeholder=\"Select a project\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"no-project\">No project</SelectItem>\n                          {projects.map((project) => (\n                            <SelectItem key={project.id} value={project.id}>\n                              {project.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"timer-task\" className=\"text-sm font-medium\">\n                        Task (Optional)\n                      </Label>\n                      <Select value={selectedTaskId} onValueChange={setSelectedTaskId}>\n                        <SelectTrigger data-testid=\"select-timer-task\">\n                          <SelectValue placeholder=\"Select a task\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"no-task\">No task</SelectItem>\n                          {tasks.map((task) => (\n                            <SelectItem key={task.id} value={task.id}>\n                              {task.description}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    \n                    <div>\n                      <Label htmlFor=\"timer-description\" className=\"text-sm font-medium\">\n                        What are you working on?\n                      </Label>\n                      <Input\n                        id=\"timer-description\"\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        placeholder=\"Enter description (optional)\"\n                        data-testid=\"input-timer-description\"\n                      />\n                    </div>\n                    \n                    <div className=\"flex justify-end space-x-2\">\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => setIsDialogOpen(false)}\n                        data-testid=\"button-cancel-timer\"\n                      >\n                        Cancel\n                      </Button>\n                      <Button\n                        onClick={handleStartTimer}\n                        disabled={startTimerMutation.isPending}\n                        className=\"bg-orange-600 hover:bg-orange-700\"\n                        data-testid=\"button-confirm-start-timer\"\n                      >\n                        {startTimerMutation.isPending ? \"Starting...\" : \"Get to Work\"}\n                      </Button>\n                    </div>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            ) : null}\n            \n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"text-orange-600 hover:bg-orange-100\"\n              data-testid=\"button-timer-settings\"\n            >\n              <Settings className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\nEND_FILE\n\nFILE: client/src/pages/productivity.tsx\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useTranslation } from \"@/lib/i18n\";\nimport { AppHeader } from \"@/components/app-header\";\nimport { TimerWidget } from \"@/components/timer-widget\";\nimport { StreakCard } from \"@/components/streak-card\";\nimport { DailyReminder } from \"@/components/daily-reminder\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Clock, TrendingUp, Calendar, BarChart3, Edit, Trash2, ArrowLeft, CheckCircle, XCircle, FileText, DollarSign } from \"lucide-react\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { useLocation } from \"wouter\";\nimport { useState, useEffect } from \"react\";\nimport type { TimeLog } from \"@shared/schema\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ProductivityStats {\n  totalHours: number;\n  averageDailyHours: number;\n  streakDays: number;\n  utilizationPercent: number;\n}\n\n// Helper function to format duration\nconst formatDuration = (seconds: number): string => {\n  const hours = Math.floor(seconds / 3600);\n  const minutes = Math.floor((seconds % 3600) / 60);\n  \n  if (hours > 0) {\n    return `${hours}h ${minutes}m`;\n  }\n  return `${minutes}m`;\n};\n\nexport default function ProductivityPage() {\n  const { t } = useTranslation();\n  const [, navigate] = useLocation();\n  const [selectedForInvoice, setSelectedForInvoice] = useState<Set<string>>(new Set());\n  const [activeTab, setActiveTab] = useState<\"all\" | \"pending\" | \"approved\" | \"rejected\">(\"all\");\n  const [editingLog, setEditingLog] = useState<TimeLog | null>(null);\n  const [editNotes, setEditNotes] = useState(\"\");\n  const [editDescription, setEditDescription] = useState(\"\");\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Scroll to top when page loads\n  useEffect(() => {\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  }, []);\n  \n  // Fetch recent time logs\n  const { data: timeLogs = [], isLoading: timeLogsLoading, isError: timeLogsError } = useQuery<TimeLog[]>({\n    queryKey: [\"/api/timelogs\"],\n    staleTime: 1000 * 60 * 2, // 2 minutes to reduce frequent refetching\n    refetchInterval: 1000 * 30, // Refetch every 30 seconds instead of constantly\n  });\n\n  // Fetch productivity stats for different periods\n  const { data: stats7Days, isLoading: stats7Loading } = useQuery<ProductivityStats>({\n    queryKey: [\"/api/productivity/stats\", { days: 7 }],\n    staleTime: 1000 * 60 * 5, // 5 minutes stale time for stats\n    refetchInterval: 1000 * 60, // Refetch every minute\n  });\n\n  const { data: stats30Days, isLoading: stats30Loading } = useQuery<ProductivityStats>({\n    queryKey: [\"/api/productivity/stats\", { days: 30 }],\n    staleTime: 1000 * 60 * 5, // 5 minutes stale time for stats\n    refetchInterval: 1000 * 60, // Refetch every minute\n  });\n\n  // Calculate running total of hours\n  const totalHours = timeLogs.reduce((total, log) => {\n    if (log.duration) {\n      return total + parseInt(log.duration);\n    }\n    return total;\n  }, 0);\n\n  const formatTotalDuration = (totalSeconds: number): string => {\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    return `${hours}h ${minutes}m`;\n  };\n\n  // Filter time logs based on approval status\n  const filteredTimeLogs = timeLogs.filter(log => {\n    if (activeTab === \"all\") return true;\n    return log.approvalStatus === activeTab;\n  });\n\n  // Approval mutation\n  const approveTimeLogMutation = useMutation({\n    mutationFn: async ({ timeLogId, status }: { timeLogId: string; status: \"approved\" | \"rejected\" }) => {\n      return apiRequest(\"POST\", `/api/timelogs/${timeLogId}/approve`, { \n        approvalStatus: status \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n    },\n  });\n\n  // Invoice selection mutation\n  const updateInvoiceSelectionMutation = useMutation({\n    mutationFn: async ({ timeLogIds, selected }: { timeLogIds: string[]; selected: boolean }) => {\n      return apiRequest(\"POST\", \"/api/timelogs/invoice-selection\", { \n        timeLogIds, \n        isSelectedForInvoice: selected \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      setSelectedForInvoice(new Set());\n    },\n  });\n\n  const handleApproval = (timeLogId: string, status: \"approved\" | \"rejected\") => {\n    approveTimeLogMutation.mutate({ timeLogId, status });\n  };\n\n  const handleInvoiceSelection = (timeLogId: string, selected: boolean) => {\n    const newSelection = new Set(selectedForInvoice);\n    if (selected) {\n      newSelection.add(timeLogId);\n    } else {\n      newSelection.delete(timeLogId);\n    }\n    setSelectedForInvoice(newSelection);\n  };\n\n  const handleBulkInvoiceUpdate = () => {\n    if (selectedForInvoice.size > 0) {\n      updateInvoiceSelectionMutation.mutate({ \n        timeLogIds: Array.from(selectedForInvoice), \n        selected: true \n      });\n    }\n  };\n\n  // Delete time log mutation\n  const deleteTimeLogMutation = useMutation({\n    mutationFn: async (timeLogId: string) => {\n      return apiRequest(\"DELETE\", `/api/timelogs/${timeLogId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      toast({ title: t('success'), description: t('deletedSuccessfully') });\n    },\n    onError: () => {\n      toast({ title: t('error'), description: t('errorOccurred'), variant: \"destructive\" });\n    },\n  });\n\n  // Update time log mutation\n  const updateTimeLogMutation = useMutation({\n    mutationFn: async ({ timeLogId, description, notes }: { timeLogId: string; description: string; notes: string }) => {\n      return apiRequest(\"PUT\", `/api/timelogs/${timeLogId}`, { description, notes });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      toast({ title: t('success'), description: t('updatedSuccessfully') });\n      setEditingLog(null);\n      setEditNotes(\"\");\n      setEditDescription(\"\");\n    },\n    onError: () => {\n      toast({ title: t('error'), description: t('errorOccurred'), variant: \"destructive\" });\n    },\n  });\n\n  const handleDelete = (timeLogId: string) => {\n    if (confirm(\"Are you sure you want to delete this time log entry?\")) {\n      deleteTimeLogMutation.mutate(timeLogId);\n    }\n  };\n\n  const handleEdit = (log: TimeLog) => {\n    setEditingLog(log);\n    setEditDescription(log.description || \"\");\n    setEditNotes(log.notes || \"\");\n  };\n\n  const handleSaveEdit = () => {\n    if (editingLog) {\n      updateTimeLogMutation.mutate({\n        timeLogId: editingLog.id,\n        description: editDescription,\n        notes: editNotes\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen\" style={{background: 'var(--cream-card)'}} data-testid=\"productivity-page\">\n      <AppHeader />\n\n      {/* Main Content */}\n      <div className=\"max-w-7xl mx-auto p-6\">\n        {/* Navigation */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => navigate(\"/\")}\n              className=\"flex items-center space-x-2\"\n              data-testid=\"button-back-to-dashboard\"\n            >\n              <ArrowLeft size={16} />\n              <span>{t('back')}</span>\n            </Button>\n            <div>\n              <h2 className=\"text-2xl font-bold brand-heading\" data-testid=\"page-title\">\n                {t('timeProductivityTools')}\n              </h2>\n              <p className=\"text-gray-700 text-sm\">\n                {t('timeProductivityDesc')}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Top Widget Section */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\n          {/* Timer Widget */}\n          <div className=\"lg:col-span-1\">\n            <TimerWidget />\n          </div>\n          \n          {/* Streak Card */}\n          <div className=\"lg:col-span-1\">\n            <StreakCard />\n          </div>\n          \n          {/* Daily Reminder */}\n          <div className=\"lg:col-span-1\">\n            <DailyReminder />\n          </div>\n        </div>\n\n        {/* Stats Overview */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8\">\n          <Card className=\"gigster-card\" data-testid=\"stat-card-running-total\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"brand-heading text-sm font-medium flex items-center space-x-2\">\n                <Clock className=\"h-4 w-4\" />\n                <span>{t('runningTotal')}</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {timeLogsLoading ? (\n                <div className=\"animate-pulse\">\n                  <div className=\"h-8 bg-gray-200 rounded mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-20\"></div>\n                </div>\n              ) : (\n                <>\n                  <div className=\"text-2xl font-bold brand-heading text-blue-600\" data-testid=\"stat-running-total\">\n                    {formatTotalDuration(totalHours)}\n                  </div>\n                  <div className=\"text-xs text-gray-600 mt-1\">\n                    {t('allTimeEntries')}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"gigster-card\" data-testid=\"stat-card-7days\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"brand-heading text-sm font-medium flex items-center space-x-2\">\n                <Calendar className=\"h-4 w-4\" />\n                <span>{t('last7Days')}</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {stats7Loading ? (\n                <div className=\"animate-pulse\">\n                  <div className=\"h-8 bg-gray-200 rounded mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-24\"></div>\n                </div>\n              ) : (\n                <>\n                  <div className=\"text-2xl font-bold brand-heading\" data-testid=\"stat-hours-7days\">\n                    {stats7Days ? `${stats7Days.totalHours}h` : \"0h\"}\n                  </div>\n                  <div className=\"text-xs text-gray-600 mt-1\">\n                    Avg: {stats7Days ? `${stats7Days.averageDailyHours}h/day` : \"0h/day\"}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"gigster-card\" data-testid=\"stat-card-30days\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"brand-heading text-sm font-medium flex items-center space-x-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                <span>{t('last30Days')}</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {stats30Loading ? (\n                <div className=\"animate-pulse\">\n                  <div className=\"h-8 bg-gray-200 rounded mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-28\"></div>\n                </div>\n              ) : (\n                <>\n                  <div className=\"text-2xl font-bold brand-heading\" data-testid=\"stat-hours-30days\">\n                    {stats30Days ? `${stats30Days.totalHours}h` : \"0h\"}\n                  </div>\n                  <div className=\"text-xs text-gray-600 mt-1\">\n                    Utilization: {stats30Days ? `${stats30Days.utilizationPercent}%` : \"0%\"}\n                  </div>\n                </>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card className=\"gigster-card\" data-testid=\"stat-card-streak\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"brand-heading text-sm font-medium flex items-center space-x-2\">\n                <BarChart3 className=\"h-4 w-4\" />\n                <span>{t('streakDays')}</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold brand-heading\" data-testid=\"stat-streak-days\">\n                {stats7Days ? stats7Days.streakDays : 0}\n              </div>\n              <div className=\"text-xs text-gray-600 mt-1\">\n                {t('currentStreak')}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"gigster-card\" data-testid=\"stat-card-total-logs\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"brand-heading text-sm font-medium flex items-center space-x-2\">\n                <Clock className=\"h-4 w-4\" />\n                <span>{t('totalSessions')}</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold brand-heading\" data-testid=\"stat-total-sessions\">\n                {timeLogs.length}\n              </div>\n              <div className=\"text-xs text-gray-600 mt-1\">\n                {t('timeEntries')}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Enhanced Time Logs Management */}\n        <Card className=\"gigster-card\" data-testid=\"enhanced-timelogs-card\">\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"brand-heading flex items-center space-x-2\">\n                <Clock className=\"h-5 w-5\" />\n                <span>Time Logs Management</span>\n              </CardTitle>\n              {selectedForInvoice.size > 0 && (\n                <Button\n                  onClick={handleBulkInvoiceUpdate}\n                  disabled={updateInvoiceSelectionMutation.isPending}\n                  className=\"bg-green-600 hover:bg-green-700 text-white\"\n                  data-testid=\"button-add-to-invoice\"\n                >\n                  <DollarSign className=\"h-4 w-4 mr-2\" />\n                  Add {selectedForInvoice.size} to Invoice\n                </Button>\n              )}\n            </div>\n            <Tabs value={activeTab} onValueChange={setActiveTab as any} className=\"mt-4\">\n              <TabsList className=\"grid w-full grid-cols-4\">\n                <TabsTrigger value=\"all\" data-testid=\"tab-all\">All ({timeLogs.length})</TabsTrigger>\n                <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">\n                  Pending ({timeLogs.filter(log => log.approvalStatus === \"pending\").length})\n                </TabsTrigger>\n                <TabsTrigger value=\"approved\" data-testid=\"tab-approved\">\n                  Approved ({timeLogs.filter(log => log.approvalStatus === \"approved\").length})\n                </TabsTrigger>\n                <TabsTrigger value=\"rejected\" data-testid=\"tab-rejected\">\n                  Rejected ({timeLogs.filter(log => log.approvalStatus === \"rejected\").length})\n                </TabsTrigger>\n              </TabsList>\n            </Tabs>\n          </CardHeader>\n          <CardContent>\n            {timeLogsLoading ? (\n              <div className=\"flex items-center justify-center py-8\" data-testid=\"timelogs-loading\">\n                <div className=\"animate-spin w-6 h-6 border-2 border-orange-600 border-t-transparent rounded-full\" />\n              </div>\n            ) : filteredTimeLogs.length === 0 ? (\n              <div className=\"text-center py-8 text-orange-700\" data-testid=\"no-timelogs\">\n                <Clock className=\"h-12 w-12 mx-auto mb-4 text-orange-400\" />\n                <p className=\"text-lg font-medium mb-2\">{t('noTimeLogged')}</p>\n                <p className=\"text-sm\">\n                  {activeTab === \"all\" \n                    ? t('startTimerToTrack')\n                    : t('noResults')\n                  }\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\" data-testid=\"timelogs-list\">\n                {filteredTimeLogs.slice(0, 20).map((log) => (\n                  <div\n                    key={log.id}\n                    className={`flex items-center justify-between p-4 rounded-lg border ${\n                      log.approvalStatus === \"approved\" \n                        ? \"bg-green-50 border-green-200\" \n                        : log.approvalStatus === \"rejected\"\n                        ? \"bg-red-50 border-red-200\"\n                        : \"bg-orange-50 border-orange-100\"\n                    }`}\n                    data-testid={`timelog-${log.id}`}\n                  >\n                    <div className=\"flex items-center space-x-3 flex-1\">\n                      {/* Invoice Selection Checkbox */}\n                      {log.approvalStatus === \"approved\" && (\n                        <Checkbox\n                          checked={selectedForInvoice.has(log.id) || Boolean(log.isSelectedForInvoice)}\n                          onCheckedChange={(checked) => handleInvoiceSelection(log.id, Boolean(checked))}\n                          disabled={Boolean(log.isSelectedForInvoice)}\n                          data-testid={`checkbox-invoice-${log.id}`}\n                        />\n                      )}\n                      \n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-3\">\n                          <div className=\"flex-1\">\n                            <div className=\"font-medium brand-heading\">\n                \n\n/* TRUNCATED_AT_18000_CHARS */\n\nEND_FILE\n\nFILE: client/src/pages/mobile-time-tracking.tsx\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  ArrowLeft, \n  Play, \n  Pause, \n  Square, \n  Clock, \n  Calendar,\n  BarChart3,\n  Plus,\n  Home,\n  Timer\n} from \"lucide-react\";\nimport { format } from \"date-fns\";\n\ninterface TimeLog {\n  id: string;\n  taskId?: string;\n  projectId?: string;\n  description: string;\n  duration: number;\n  date: string;\n  startTime?: string;\n  endTime?: string;\n}\n\nexport default function MobileTimeTracking() {\n  const [isTracking, setIsTracking] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [startTime, setStartTime] = useState<Date | null>(null);\n  const [description, setDescription] = useState(\"\");\n\n  // Update timer every second when tracking\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    if (isTracking && startTime) {\n      interval = setInterval(() => {\n        setCurrentTime(Math.floor((new Date().getTime() - startTime.getTime()) / 1000));\n      }, 1000);\n    }\n    return () => clearInterval(interval);\n  }, [isTracking, startTime]);\n\n  const { data: timeLogs = [], isLoading } = useQuery<TimeLog[]>({\n    queryKey: [\"/api/timelogs\"],\n  });\n\n  const formatTime = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const formatDuration = (minutes: number) => {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return hours > 0 ? `${hours}h ${mins}m` : `${mins}m`;\n  };\n\n  const handleStartTimer = () => {\n    setIsTracking(true);\n    setStartTime(new Date());\n    setCurrentTime(0);\n  };\n\n  const handlePauseTimer = () => {\n    setIsTracking(false);\n  };\n\n  const handleStopTimer = () => {\n    setIsTracking(false);\n    setStartTime(null);\n    setCurrentTime(0);\n    setDescription(\"\");\n    // Here you would save the time log\n  };\n\n  // Calculate today's total time\n  const today = new Date().toISOString().split('T')[0];\n  const todayLogs = timeLogs.filter(log => log.date === today);\n  const todayTotal = todayLogs.reduce((sum, log) => sum + log.duration, 0);\n\n  // Calculate this week's total time\n  const weekStart = new Date();\n  weekStart.setDate(weekStart.getDate() - weekStart.getDay());\n  const weekLogs = timeLogs.filter(log => new Date(log.date) >= weekStart);\n  const weekTotal = weekLogs.reduce((sum, log) => sum + log.duration, 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-[#004C6D] to-[#0B1D3A] flex items-center justify-center p-4\">\n        <div className=\"text-center text-white\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4\"></div>\n          <p className=\"text-lg font-medium\">Loading Time Tracking...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-[#004C6D] to-[#0B1D3A]\">\n      {/* Header */}\n      <div className=\"bg-[#004C6D] px-4 py-6 shadow-lg\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Link href=\"/mobile\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"text-white hover:bg-white/20 p-2\"\n                data-testid=\"button-back\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n            <div>\n              <h1 className=\"text-2xl font-bold text-white\">‚è±Ô∏è Time Tracking</h1>\n              <p className=\"text-blue-100 text-sm\">Track your productivity</p>\n            </div>\n          </div>\n          <Link href=\"/mobile\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-white hover:bg-white/20 p-2\"\n              data-testid=\"button-home\"\n            >\n              <Home className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n        </div>\n      </div>\n\n      <div className=\"p-4 space-y-6\">\n        {/* Active Timer */}\n        <Card className=\"bg-white/95 backdrop-blur border-0 shadow-lg\" data-testid=\"card-active-timer\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center space-y-4\">\n              {/* Timer Display */}\n              <div className=\"text-4xl font-mono font-bold text-[#004C6D]\" data-testid=\"text-timer-display\">\n                {formatTime(currentTime)}\n              </div>\n              \n              {isTracking && (\n                <div className=\"flex items-center justify-center text-sm text-green-600\">\n                  <div className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2\"></div>\n                  Recording time...\n                </div>\n              )}\n\n              {/* Description Input */}\n              <div className=\"space-y-2\">\n                <Input\n                  placeholder=\"What are you working on?\"\n                  value={description}\n                  onChange={(e) => setDescription(e.target.value)}\n                  className=\"text-center\"\n                  data-testid=\"input-description\"\n                />\n              </div>\n\n              {/* Timer Controls */}\n              <div className=\"flex justify-center space-x-4\">\n                {!isTracking ? (\n                  <Button\n                    onClick={handleStartTimer}\n                    className=\"bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full\"\n                    data-testid=\"button-start-timer\"\n                  >\n                    <Play className=\"h-5 w-5 mr-2\" />\n                    Start\n                  </Button>\n                ) : (\n                  <>\n                    <Button\n                      onClick={handlePauseTimer}\n                      variant=\"outline\"\n                      className=\"px-6 py-3 rounded-full\"\n                      data-testid=\"button-pause-timer\"\n                    >\n                      <Pause className=\"h-5 w-5 mr-2\" />\n                      Pause\n                    </Button>\n                    <Button\n                      onClick={handleStopTimer}\n                      className=\"bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-full\"\n                      data-testid=\"button-stop-timer\"\n                    >\n                      <Square className=\"h-4 w-4 mr-2\" />\n                      Stop\n                    </Button>\n                  </>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Time Summary */}\n        <Card className=\"bg-white/95 backdrop-blur border-0 shadow-lg\" data-testid=\"card-time-summary\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center text-[#004C6D]\">\n              <BarChart3 className=\"h-5 w-5 mr-2\" />\n              Time Summary\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"text-center p-3 bg-blue-50 rounded-lg\">\n                <div className=\"text-xl font-bold text-blue-600\" data-testid=\"text-today-total\">\n                  {formatDuration(todayTotal)}\n                </div>\n                <div className=\"text-xs text-blue-600\">Today</div>\n              </div>\n              <div className=\"text-center p-3 bg-green-50 rounded-lg\">\n                <div className=\"text-xl font-bold text-green-600\" data-testid=\"text-week-total\">\n                  {formatDuration(weekTotal)}\n                </div>\n                <div className=\"text-xs text-green-600\">This Week</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Recent Time Logs */}\n        <Card className=\"bg-white/95 backdrop-blur border-0 shadow-lg\" data-testid=\"card-recent-logs\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center text-[#004C6D]\">\n              <Clock className=\"h-5 w-5 mr-2\" />\n              Recent Logs\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {todayLogs.slice(0, 5).map((log, index) => (\n                <div key={log.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\" data-testid={`row-time-log-${index}`}>\n                  <div className=\"flex-1\">\n                    <div className=\"text-sm font-medium text-gray-900\">\n                      {log.description || 'Untitled session'}\n                    </div>\n                    <div className=\"text-xs text-gray-500 flex items-center\">\n                      <Calendar className=\"h-3 w-3 mr-1\" />\n                      {format(new Date(log.date), 'MMM d, yyyy')}\n                      {log.startTime && (\n                        <span className=\"ml-2\">\n                          {format(new Date(log.startTime), 'h:mm a')}\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"text-sm font-medium text-[#004C6D]\">\n                      {formatDuration(log.duration)}\n                    </div>\n                  </div>\n                </div>\n              ))}\n\n              {todayLogs.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <Timer className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"text-sm\">No time logged today</p>\n                  <p className=\"text-xs\">Start your first timer above</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Switch to Desktop */}\n        <Card className=\"bg-white/95 backdrop-blur border-0 shadow-lg\" data-testid=\"card-switch-desktop\">\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center\">\n              <p className=\"text-sm text-gray-600 mb-3\">\n                Need the full platform?\n              </p>\n              <a \n                href=\"/?desktop=true\"\n                className=\"inline-block bg-[#004C6D] text-white px-6 py-3 rounded-lg font-medium hover:bg-[#003A52] transition-colors\"\n                data-testid=\"link-desktop-version\"\n              >\n                üñ•Ô∏è Switch to Desktop Version\n              </a>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Add bottom padding */}\n        <div className=\"h-8\"></div>\n      </div>\n    </div>\n  );\n}\nEND_FILE\n\nFILE: client/src/components/app-header.tsx\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { CheckCheck, LogOut, Settings, User, Users, Plus, Mail, Shield, Home, Database, Zap, Bot, Clock, Brain, BarChart3, Webhook, Key, FileText, Globe } from \"lucide-react\";\nimport { NavigationMenu } from \"./navigation-menu\";\nimport { Link } from \"wouter\";\nimport { GigsterLogo } from \"./vsuite-logo\";\nimport { ReminderModal } from \"@/components/reminder-modal\";\nimport { GlobalSearch } from \"@/components/global-search\";\nimport { MoodPaletteSwitcher } from \"@/components/MoodPaletteSwitcher\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DemoModeIndicator } from \"@/components/DemoModeBanner\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport type { Task, TimeLog } from \"@shared/schema\";\nimport { startOfDay, addDays } from \"date-fns\";\nimport { useState, useEffect } from \"react\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport function AppHeader() {\n  const { user, isAdmin } = useAuth();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [, navigate] = useLocation();\n  const [currentTime, setCurrentTime] = useState(0);\n\n  const { data: tasks = [] } = useQuery<Task[]>({\n    queryKey: [\"/api/tasks\"],\n  });\n\n  // Fetch active timer\n  const { data: activeTimer } = useQuery<TimeLog | null>({\n    queryKey: [\"/api/timelogs/active\"],\n    refetchInterval: (data) => (data && (data as any).isActive ? 5000 : 30000),\n    staleTime: 1000 * 2,\n    refetchOnWindowFocus: false,\n    refetchOnReconnect: false,\n  });\n\n  // Update current time for active timer\n  useEffect(() => {\n    if (activeTimer && activeTimer.isActive) {\n      const interval = setInterval(() => {\n        const now = Date.now();\n        const startTime = new Date(activeTimer.startTime).getTime();\n        setCurrentTime(Math.floor((now - startTime) / 1000));\n      }, 1000);\n\n      return () => clearInterval(interval);\n    } else {\n      setCurrentTime(0);\n    }\n  }, [activeTimer]);\n\n  // Format duration for display\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/logout\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Logged out\",\n        description: \"You have been logged out successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const stopTimerMutation = useMutation({\n    mutationFn: async (timeLogId: string) => {\n      return apiRequest(\"POST\", \"/api/timelogs/stop\", { timeLogId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs/active\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/productivity/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/streaks\"] });\n      setCurrentTime(0);\n      toast({\n        title: \"Timer stopped\",\n        description: \"Your work session has been saved\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleStopTimer = () => {\n    if (activeTimer) {\n      stopTimerMutation.mutate(activeTimer.id);\n    }\n  };\n\n  // Calculate reminder count\n  const getReminderCount = () => {\n    const now = new Date();\n    const today = startOfDay(now);\n    const tomorrow = addDays(today, 1);\n    \n    return tasks.filter(task => {\n      if (task.completed || !task.dueDate) return false;\n      \n      const dueDate = startOfDay(new Date(task.dueDate));\n      return dueDate.getTime() <= tomorrow.getTime();\n    }).length;\n  };\n\n  const reminderCount = getReminderCount();\n\n  return (\n    <header className=\"gg-header border-b sticky top-0 z-50 shadow-lg\">\n      <div className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4\">\n        <div className=\"flex flex-col space-y-3 sm:space-y-4\">\n          {/* Top line: Shield + Logo + Tagline + Timer */}\n          <div className=\"flex items-center justify-center\">\n            <div className=\"flex items-center space-x-2 sm:space-x-3\">\n              <GigsterLogo size=\"small\" showText={false} />\n              <h1 className=\"text-lg sm:text-xl font-bold text-white\" style={{ fontFamily: 'var(--font-display)' }}>\n                Gigster Garage\n              </h1>\n              \n              {/* Active Timer Display */}\n              {activeTimer && activeTimer.isActive && (\n                <>\n                  <span style={{ color: 'var(--brand-amber-tint)' }} className=\"font-medium\">|</span>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={handleStopTimer}\n                    disabled={stopTimerMutation.isPending}\n                    className=\"flex items-center space-x-1 sm:space-x-2 bg-white/20 backdrop-blur-sm rounded-lg px-2 py-1 hover:bg-white/30 transition-colors\"\n                    title=\"Click to stop timer\"\n                  >\n                    <Clock size={14} className=\"text-white animate-pulse\" />\n                    <span className=\"text-sm sm:text-base font-bold text-white\" style={{ fontFamily: 'monospace' }}>\n                      {formatDuration(currentTime)}\n                    </span>\n                    <span className=\"text-xs text-white/80 hidden sm:inline\">\n                      {activeTimer.description || \"Working\"}\n                    </span>\n                  </Button>\n                </>\n              )}\n              \n              <span style={{ color: 'var(--brand-amber-tint)' }} className=\"font-medium hidden sm:inline\">|</span>\n              <p className=\"text-xs sm:text-sm font-medium hidden sm:block\" style={{ color: 'var(--brand-amber-tint)' }}>{t(\"tagline\")}</p>\n            </div>\n          </div>\n\n          {/* Middle line: Search */}\n          <div className=\"flex justify-center px-2\">\n            <div className=\"w-full max-w-md\">\n              <GlobalSearch className=\"w-full\" />\n            </div>\n          </div>\n          \n          {/* Bottom line: User + Messages */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2 sm:space-x-3 text-xs sm:text-sm text-white/80\">\n              <User size={14} className=\"sm:w-4 sm:h-4 text-white\" />\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => logoutMutation.mutate()}\n                disabled={logoutMutation.isPending}\n                className=\"text-white hover:bg-white/10 font-medium p-1 h-auto text-xs sm:text-sm\"\n              >\n                {user?.name}\n              </Button>\n              {user?.role === 'admin' && (\n                <span className=\"bg-white/20 text-white px-1.5 sm:px-2 py-0.5 rounded-full text-xs font-medium border border-white/30\">\n                  {t(\"admin\")}\n                </span>\n              )}\n            </div>\n            \n            {/* Demo Mode Indicator */}\n            <DemoModeIndicator />\n            \n            <div className=\"flex items-center space-x-2 sm:space-x-3\">\n              {/* Home Button - Keep for quick access */}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => navigate(\"/\")}\n                className=\"text-white hover:bg-white/10 relative p-1.5 sm:p-2\"\n                data-testid=\"button-home\"\n                title={t(\"dashboard\")}\n              >\n                <Home size={16} className=\"sm:w-[18px] sm:h-[18px] text-white\" />\n              </Button>\n\n              {/* Quick Access Tasks Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => navigate(\"/tasks\")}\n                className=\"text-white hover:bg-white/10 relative p-1.5 sm:p-2\"\n                data-testid=\"button-tasks\"\n                title={t(\"tasks\")}\n              >\n                <CheckCheck size={16} className=\"sm:w-[18px] sm:h-[18px] text-white\" />\n              </Button>\n\n              {/* Organized Navigation Menu - Replaces all the scattered buttons */}\n              <NavigationMenu />\n              \n              {/* Mood Palette Switcher */}\n              <MoodPaletteSwitcher size=\"sm\" className=\"text-white border-white/20 hover:bg-white/10\" />\n              \n              {/* Settings/Language Button */}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => navigate(\"/settings\")}\n                className=\"text-white hover:bg-white/10 relative p-1.5 sm:p-2\"\n                data-testid=\"button-settings\"\n                title={t(\"settings\")}\n              >\n                <Globe size={16} className=\"sm:w-[18px] sm:h-[18px] text-white\" />\n              </Button>\n              \n              {/* Keep Message System for notifications */}\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => navigate(\"/messages\")}\n                className=\"text-white hover:bg-white/10 relative p-1.5 sm:p-2\"\n                data-testid=\"button-messages\"\n                title={t(\"messages\")}\n              >\n                <Mail size={16} className=\"sm:w-[18px] sm:h-[18px] text-white\" />\n                {/* Show badge if there are unread messages */}\n                <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 sm:w-5 sm:h-5 flex items-center justify-center font-bold\">\n                  0\n                </span>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n\nEND_FILE\n\nFILE: client/src/components/QuickActionButton.tsx\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Plus, Clock, FileText, Users, Folder, FileSignature, Play, Zap } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useTranslation } from \"@/lib/i18n\";\n\nexport function QuickActionButton() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [open, setOpen] = useState(false);\n\n  const startTimerMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"POST\", \"/api/timelogs/start\", { description: \"Working\" });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/timelogs/active\"] });\n      toast({\n        title: t('timerStarted'),\n        description: t('workSessionBegun'),\n      });\n      setOpen(false);\n    },\n  });\n\n  const quickActions = [\n    {\n      icon: <Clock className=\"h-4 w-4\" />,\n      label: t('newTask'),\n      shortcut: \"N\",\n      action: () => {\n        navigate(\"/tasks\");\n        setOpen(false);\n      },\n    },\n    {\n      icon: <Play className=\"h-4 w-4\" />,\n      label: t('startTimer'),\n      shortcut: \"T\",\n      action: () => {\n        startTimerMutation.mutate();\n      },\n    },\n    {\n      icon: <Folder className=\"h-4 w-4\" />,\n      label: t('newProject'),\n      action: () => {\n        navigate(\"/\");\n        setOpen(false);\n      },\n    },\n    {\n      icon: <FileText className=\"h-4 w-4\" />,\n      label: t('createInvoice'),\n      action: () => {\n        navigate(\"/create-invoice\");\n        setOpen(false);\n      },\n    },\n    {\n      icon: <FileSignature className=\"h-4 w-4\" />,\n      label: t('createProposal'),\n      action: () => {\n        navigate(\"/create-proposal\");\n        setOpen(false);\n      },\n    },\n    {\n      icon: <Users className=\"h-4 w-4\" />,\n      label: t('addClient'),\n      action: () => {\n        navigate(\"/clients\");\n        setOpen(false);\n      },\n    },\n  ];\n\n  return (\n    <div className=\"fixed bottom-6 right-6 z-40\">\n      <DropdownMenu open={open} onOpenChange={setOpen}>\n        <DropdownMenuTrigger asChild>\n          <Button\n            size=\"lg\"\n            className=\"h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-110\"\n            style={{ background: \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\" }}\n            data-testid=\"quick-action-fab\"\n          >\n            <Plus className=\"h-6 w-6\" />\n          </Button>\n        </DropdownMenuTrigger>\n        <DropdownMenuContent align=\"end\" className=\"w-56 mb-2\">\n          <DropdownMenuLabel className=\"flex items-center gap-2\">\n            <Zap className=\"h-4 w-4\" />\n            {t('quickActions')}\n          </DropdownMenuLabel>\n          <DropdownMenuSeparator />\n          {quickActions.map((action, index) => (\n            <DropdownMenuItem\n              key={index}\n              onClick={action.action}\n              className=\"flex items-center gap-3 cursor-pointer\"\n              data-testid={`quick-action-${action.label.toLowerCase().replace(/\\s+/g, \"-\")}`}\n            >\n              {action.icon}\n              <span className=\"flex-1\">{action.label}</span>\n              {action.shortcut && (\n                <kbd className=\"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100\">\n                  {action.shortcut}\n                </kbd>\n              )}\n            </DropdownMenuItem>\n          ))}\n        </DropdownMenuContent>\n      </DropdownMenu>\n    </div>\n  );\n}\n\nEND_FILE\n\n",
    "created_at": "2025-12-29T15:02:50.706Z"
  },
  "approval": {
    "approved_by": "Dustin Sparks",
    "approved_at": "2025-12-29T15:09:35.410Z"
  }
}