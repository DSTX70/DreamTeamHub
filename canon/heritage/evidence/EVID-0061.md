# EVID-0061: Work Item Execution Pipeline

**Date:** 2025-12-27
**Pod:** Heritage Pod
**Type:** Implementation Evidence
**Status:** Active

## Overview

Added a file-backed execution pipeline for Work Items that implements the pattern:
```
NONE → RECOMMENDATION_DRAFT → RECOMMENDATION_APPROVED → DROP_READY
```

## Design Principles

1. **Non-executing by design**: All outputs are paste-ready text that must be manually applied
2. **Approval gates**: Recommendation must be approved before drop generation is enabled
3. **No schema changes**: Uses file-backed storage (`data/work-item-stages/<workItemId>.json`)
4. **Target repo isolation**: Pilot drops target GigsterGarage only (no auto-apply, no VSuiteHQ push)

## Implementation

### Backend (`server/lib/workItemStages.ts`)
- `getStage(workItemId)`: Returns stage record (creates if not exists)
- `saveStage(rec)`: Persists stage record to file
- `buildRecommendation(params)`: Generates non-executing recommendation text
- `buildDrop(params)`: Generates FILE/END_FILE drop template

### API Routes (`server/routes/workItemStages.ts`)
- `GET  /api/work-items/:id/stage` - Read current stage
- `POST /api/work-items/:id/stage/recommendation` - Generate recommendation draft
- `POST /api/work-items/:id/stage/approve` - Approve recommendation (Dustin gate)
- `POST /api/work-items/:id/stage/drop` - Generate paste-ready drop for target repo

### UI (`client/src/pages/work-item-detail.tsx`)
- Execution Pipeline card with stage display
- "Generate Recommendation" button
- "Approve Recommendation" button (disabled until recommendation exists)
- "Generate GigsterGarage Drop" button (disabled until approved)
- Copyable drop output

## Stage Flow

```
[NONE] 
   ↓ Generate Recommendation
[RECOMMENDATION_DRAFT]
   ↓ Approve Recommendation  
[RECOMMENDATION_APPROVED]
   ↓ Generate Drop
[DROP_READY] → Manual paste to GigsterGarage
```

## File Storage

Stage artifacts stored at: `data/work-item-stages/<workItemId>.json`

```json
{
  "workItemId": "123",
  "stage": "DROP_READY",
  "created_at": "...",
  "updated_at": "...",
  "recommendation": { "text": "...", "created_at": "..." },
  "approval": { "approved_by": "Dustin Sparks", "approved_at": "..." },
  "drop": { "targetRepo": "GigsterGarage", "text": "...", "created_at": "..." }
}
```

## Related

- EVID-0060: Strategy → Lock → Convert → Work Pipeline
- DTH-20251226-058: Strategy Session feature decision
